version: 1

projects:
  anvil:
    path: ../anvil
    url: git@github.com:Beta-Techno/anvil.git
    desc: Ubuntu workstation/server bootstrap (Ansible)
    tags: [infra, provisioning, dev, server]

  boot:
    path: ../boot
    url: git@github.com:Beta-Techno/boot.git
    desc: Ubuntu autoinstall shim that hands off to Anvil
    tags: [infra, installer, server]

  harbor:
    path: ../harbor
    url: git@github.com:Beta-Techno/harbor.git
    desc: Stack manager + harborctl CLI for Docker Compose deployments
    tags: [infra, platform, server]

  lockbox:
    path: ../lockbox
    url: git@github.com:Beta-Techno/lock.git
    desc: SOPS-encrypted runtime config + lockctl renderer
    tags: [infra, secrets, server]

  key:
    path: ../key
    url: git@github.com:Beta-Techno/key.git
    desc: Bootstrap bundle store for Git identity, tokens, age keys
    tags: [infra, secrets]

  bricks:
    path: ../bricks
    url: git@github.com:Beta-Techno/bricks.git
    desc: Reusable containers and base images shared across stacks
    tags: [infra, tooling]

  ops:
    path: ../ops
    url: git@github.com:Beta-Techno/ops.git
    desc: Fleet operations glue (scripts, automation, runbooks)
    tags: [infra, ops]

  flakes:
    path: ../flakes
    url: git@github.com:Beta-Techno/flakes.git
    desc: Collection of Nix flakes to drive future bootstrap flow
    tags: [infra, nix]

  dotfiles:
    path: ../dotfiles
    url: git@github.com:Beta-Techno/dotfiles.git
    desc: Chezmoi source for cross-host shell/editor setup
    tags: [infra, dev]

  betatech-static:
    path: ../../web/static/betatech
    url: git@github.com:Beta-Techno/betatech.git
    desc: Static marketing site (Astro)
    tags: [web, static, infra]

  betatech-solid:
    path: ../../web/solid/betatech
    url: git@github.com:Beta-Techno/betatech.git
    desc: SolidJS variant of Betatech site
    tags: [web, solid, infra]

  wiki:
    path: ../../web/react/wiki
    url: git@github.com:Beta-Techno/wiki.git
    desc: React-based documentation/wiki frontend
    tags: [web, react, infra]

commands:
  status:
    desc: Show terse git status
    cmd: git status -sb

  sync:
    desc: Fast-forward to origin/main for repos that already exist
    cmd: |
      git fetch --all --prune
      git pull --ff-only || true

  bootstrap:
    desc: Run project bootstrap scripts when present
    cmd: |
      if [ -x ./bootstrap.sh ]; then
        ./bootstrap.sh
      elif [ -x ./run.sh ]; then
        ./run.sh
      elif [ -f package.json ] && [ -n "$(command -v npm)" ]; then
        npm install
      fi

  lockbox-render:
    desc: Render env files for Harbor stacks via lockctl
    target:
      projects: [lockbox]
    cmd: |
      LOCKCTL_BIN=${LOCKCTL_BIN:-lockctl}
      ENV=${LOCKBOX_ENV:-dev}
      STACK=${LOCKBOX_STACK:-all}
      OUT_DIR=${LOCKBOX_OUT:-$HOME/code/infra/harbor}
      "$LOCKCTL_BIN" render --repo . --project harbor --env "$ENV" --stack "$STACK" --out "$OUT_DIR"

  harbor-validate:
    desc: Validate Harbor catalog against lockbox contracts
    target:
      projects: [harbor]
    cmd: |
      ENV=${HARBOR_ENV:-dev}
      SOPS_AGE_KEY_FILE=${SOPS_AGE_KEY_FILE:?SOPS_AGE_KEY_FILE must be set}
      go run ./cmd/harborctl catalog validate --env "$ENV"

  bootstrap-all:
    desc: Run sync + bootstrap for all infra repos
    spec: custom
    target:
      tags: [infra]
    commands:
      - task: sync
      - task: bootstrap
  devdoc:
    path: ../../web/nextjs/devdoc
    url: git@github.com:Beta-Techno/devdoc.git
    desc: Next.js developer documentation site
    tags: [web, nextjs, infra]

  pion:
    path: ../../web/static/pion
    url: git@github.com:Beta-Techno/pion.git
    desc: Static marketing site
    tags: [web, static, infra]

  tele:
    path: ../../web/static/tele
    url: git@github.com:Beta-Techno/tele.git
    desc: Static marketing site
    tags: [web, static, infra]

  dog:
    path: ../../web/static/dog
    url: git@github.com:Beta-Techno/dog.git
    desc: Static marketing site
    tags: [web, static, infra]


  civct-static:
    path: ../../web/static/civct
    url: git@github.com:Beta-Techno/civct.git
    desc: CIVCT marketing site
    tags: [web, static, infra]

  civct-mono:
    path: ../../web/mono/civct
    url: git@github.com:Beta-Techno/civct.git
    desc: CIVCT ASP.NET monolith
    tags: [web, monolith, infra]

  build:
    path: ../../web/nextjs/build
    url: git@github.com:Beta-Techno/build.git
    desc: Next.js site
    tags: [web, nextjs, infra]

  codec:
    path: ../../web/react/codec
    url: git@github.com:Beta-Techno/codec.git
    desc: React application
    tags: [web, react, infra]

  qualia:
    path: ../../web/react/qualia
    url: git@github.com:Beta-Techno/qualia.git
    desc: React application
    tags: [web, react, infra]

  redray:
    path: ../../web/react/redray
    url: git@github.com:Beta-Techno/redray.git
    desc: React application
    tags: [web, react, infra]

  pos:
    path: ../../web/svelte/pos
    url: git@github.com:Beta-Techno/pos.git
    desc: Svelte POS app
    tags: [web, svelte, infra]

  comms:
    path: ../../web/svelte/comms
    url: git@github.com:Beta-Techno/comms.git
    desc: Svelte communications portal
    tags: [web, svelte, infra]

  beta-pack:
    path: ../../web/npm/beta-pack
    url: git@github.com:Beta-Techno/beta-pack.git
    desc: Shared npm package
    tags: [web, npm, infra]

  goo:
    path: ../goo
    url: git@github.com:Beta-Techno/goo.git
    desc: Internal Go tooling
    tags: [infra, tools]

  gate:
    path: ../../service/go/gate
    url: git@github.com:Beta-Techno/gate.git
    desc: Go service
    tags: [service, go, infra]

  aips:
    path: ../../service/go/aips
    url: git@github.com:Beta-Techno/aips.git
    desc: Go service
    tags: [service, go, infra]

  postal:
    path: ../../service/go/postal
    url: git@github.com:Beta-Techno/postal.git
    desc: Go service
    tags: [service, go, infra]

  bion:
    path: ../../service/go/bion
    url: git@github.com:Beta-Techno/bion.git
    desc: Go service
    tags: [service, go, infra]

  beam:
    path: ../../service/go/beam
    url: git@github.com:Beta-Techno/beam.git
    desc: Go service
    tags: [service, go, infra]

  socials:
    path: ../../service/typescript/socials
    url: git@github.com:Beta-Techno/socials.git
    desc: TypeScript service
    tags: [service, typescript, infra]

  twil:
    path: ../../service/typescript/twil
    url: git@github.com:Beta-Techno/twil.git
    desc: TypeScript service
    tags: [service, typescript, infra]

  codehub:
    path: ../../service/typescript/codehub
    url: git@github.com:Beta-Techno/codehub.git
    desc: TypeScript service
    tags: [service, typescript, infra]

  gogh:
    path: ../../service/typescript/gogh
    url: git@github.com:Beta-Techno/gogh.git
    desc: TypeScript service
    tags: [service, typescript, infra]
